# Руководство по разработке

Этот документ описывает локальную настройку окружения, полезные команды и то, как работает автоматизация релизов.

## Предпосылки
- Node.js 22 LTS или новее
- npm 10+
- Git

Рекомендуется устанавливать зависимости через `npm install` в корне репозитория.

## Старт проекта
- Склонируйте репозиторий и переключитесь на нужную ветку.
- Выполните `npm install`, чтобы подтянуть зависимости из `package-lock.json`.
- Запустите локальный сервер Vite командой `npm run dev`. UI станет доступен по адресу, который напечатает Vite.

## Основные команды
- `npm run dev` — запускает дев-сервер Vite с горячей перезагрузкой.
- `npm run build` — собирает production-версию UI в `extension/ui/dist`.
- `npm run preview` — локально проверяет production-сборку.
- `npm run typecheck` — выполняет `tsc --noEmit` для проверки типов.
- `npm run test` — запускает Vitest в headless-режиме и останавливается при первой ошибке.
- `npm run test:watch` — запускает Vitest в режиме наблюдения.
- `npm run test:coverage` — генерирует отчёт покрытия (text + HTML) через `vitest --coverage`.
- `npm run release` — запускает Semantic Release (использует `npx` и установит все плагины на лету).

## Коммит-месседжи
CI/CD и автоматические релизы основаны на схеме [Conventional Commits](https://www.conventionalcommits.org/ru/v1.0.0/). Примеры корректных сообщений:

```
feat(bots): добавить фильтр по бирже
fix(backtests): корректно подсвечивать просроченные очереди
chore: обновить зависимости ui
```

## GitHub Actions
Пайплайн описан в `.github/workflows/ci.yml` и выполняет четыре последовательных шага:
1. `typecheck` — проверка типов через `tsc --noEmit`.
2. `test` — прогон `npm run test` с Vitest.
3. `build` — сборка UI и публикация артефакта с содержимым `extension/ui/dist`.
4. `release` — запускает Semantic Release только при пуше в `main`.

Для установки зависимостей используется `npm ci` с включённым кешем npm (`actions/setup-node`), что ускоряет прогон внутри одного workflow.

## Semantic Release
Semantic Release автоматически:
- анализирует Conventional Commits и определяет следующий семантический версионинг,
- обновляет `CHANGELOG.md`,
- создаёт GitHub Release с заметками,
- пушит изменения обратно в `main`.

В GitHub Actions достаточно стандартного `GITHUB_TOKEN`, который предоставляет репозиторий. При локальном запуске экспортируйте `GH_TOKEN` или `GITHUB_TOKEN` со значением персонального токена с правами `repo`.

Локально можно повторить процесс так же, как в CI:

```
npm install
npm run release
```

Перед запуском убедитесь, что в репозитории нет незакоммиченных изменений — Semantic Release остановится, если рабочая копия грязная.

## Проверка перед PR/MR
- Выполните `npm run typecheck`, `npm run test` и `npm run build` локально.
- Убедитесь, что Conventional Commit выполнен и описывает изменения.
- Пробежитесь по тестовым сценариям из `README.md` («Использование») вручную, если вносились изменения в UI или процессы бэктестов.
